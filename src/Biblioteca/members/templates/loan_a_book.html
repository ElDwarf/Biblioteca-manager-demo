{% extends 'base.html'%}

{% block title  %} Loan a book {% endblock%}

{% block body  %}


<div class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full space-y-8">


    <h2  class=" title-validation-{{ form_validation_message.title.type }}">
          {{ form_validation_message.title.text }}
    </h2>
    <h2  class=" title-validation-{{ form_validation_message.secondary_title.type }}">
      {{ form_validation_message.secondary_title.text }}
    </h2>

    {% if form_options.member and  form_options.book %}
    
      <form class="mt-8 space-y-6" action="{% url 'loan_a_book' %}" method="POST">
        {% csrf_token %}

        <!--
        <input type="hidden" name="next" value="{{ next }}" />
        <input type="hidden" name="remember" value="true">
        -->

        <input id="utc_offset_minutes" type="hidden" name="utc_offset_minutes" value="">
                
        <div class="rounded-md shadow-sm pb-4">
          
          <div class="py-3">
            <label for="id_member" class="sr-only">member</label>
            
            <select name="member" id="id_member"  required class="rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm">                        
              <option value="{{ form_values.member.id }}" selected="">{{ form_values.member.value }}</option>            
              {% for member in form_options.member %}              
                {% if member.id != form_values.member.id %}                
                  <option value="{{ member.id }}">{{ member.value }}</option>
                {% endif %}
              {% endfor %}            
            </select>
            
            <ul class="list-none">
              {% for message in form_validation_message.member %}        
                <li class="field-validation-danger">{{ message }}</li>
              {% endfor %}
            </ul>
          </div>

          <div class="py-3">
            <label for="id_book" class="sr-only">book</label>
            
            <select name="book" id="id_book"  required class="rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm">
              <option value="{{ form_values.book.id }}" selected="">{{ form_values.book.value }}</option>            
              {% for book in form_options.book %}              
                {% if book.id != form_values.book.id %}                
                  <option value="{{ book.id }}">{{ book.value }}</option>
                {% endif %}
              {% endfor %}          
            </select>

            <ul class="list-none">
              {% for message in form_validation_message.book %}        
              <li class="field-validation-danger">{{ message }}</li>
              {% endfor %}
            </ul>
          </div>

          <div>
            <label for="id_due_date" class="sr-only">due_date</label>
            <input id="id_due_date" name="due_date" value="{{form_values.due_date.value}}" type="datetime-local" autocomplete="text" min="" max="" required class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Loan due date">
            <ul class="list-none">
              {% for message in form_validation_message.due_date %}        
              <li class="field-validation-danger">{{ message }}</li>
              {% endfor %}            
            </ul>
          </div>
          
        </div>

        <div>
          <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <span class="absolute left-0 inset-y-0 flex items-center pl-3"> </span> Register loan          
          </button>
        </div>
      </form>
      
      <script type="text/javascript">
        const now = new Date();        
        
        const utcOffsetMinutes = now.getTimezoneOffset();          
        document.getElementById('utc_offset_minutes').value = utcOffsetMinutes;
        
        //datetime-local input format: 2022-01-20T13:14
        const nowMonth =  String( parseInt( now.getMonth()) + 1 ).padStart(2, '0')        
        const minimunDueDateTime = 
                now.getFullYear() + '-' +
                nowMonth + '-' + 
                now.getDate() + 'T' + 
                now.getHours() + ':' + 
                now.getMinutes();
        console.log( minimunDueDateTime )
        document.getElementById('id_due_date').setAttribute('min', minimunDueDateTime);
      
      </script>      

    {% endif %}


    <div class=" inline-flex rounded-md shadow mt-8 space-y-6">
      <a href="/members/loans" class="inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-indigo-50">
          < Loan list
      </a>
     </div>

    

  </div>
</div>




{% endblock%}